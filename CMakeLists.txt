cmake_minimum_required(VERSION 3.3)
project(Meerkat2-average)

set(LIBCBF_DIR lib/CBFlib-0.9.3.1)
set(LIBHDF5_DIR lib/hdf5)

set(HDF5_LIBRARIES hdf5_hl_cpp hdf5_cpp hdf5_hl hdf5 szip z )

include_directories(${LIBHDF5_DIR}/include ${LIBCBF_DIR}/include lib/eigen)
link_directories(${LIBHDF5_DIR}/lib ${LIBCBF_DIR}/lib)

set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11") # -O3

set(SOURCE_FILES
        InputParameters.cpp InputParameters.h Exceptions.h Symmetry.cpp Symmetry.h IntensityData.cpp IntensityData.h)
add_library(meerkat-average-lib ${SOURCE_FILES})
add_executable(Meerkat2-average main.cpp)
target_link_libraries(Meerkat2-average meerkat-average-lib libcbf.a ${HDF5_LIBRARIES})

set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${CMAKE_SOURCE_DIR}/lib/cxxtest/build_tools/cmake")
find_package(CxxTest)

if(CXXTEST_FOUND)
    include_directories(${CXXTEST_INCLUDES})
    cxx_test(test-meerkat-average test_meerkat_average.h)
    target_link_libraries(test-meerkat-average meerkat-average-lib ${HDF5_LIBRARIES})
endif()
